<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>LINE: Obscura :: Boot Terminal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: #000;
  color: #b5b5b5;
  font-family: "Courier New", Courier, monospace;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* ===== TERMINAL ===== */

.terminal {
  width: 90%;
  max-width: 760px;
  padding: 32px;
  border: 2px solid #2a2a2a;
  background: radial-gradient(circle at center, #0a0a0a 0%, #000 70%);
  box-shadow: 0 0 25px rgba(120,120,120,0.08);
  position: relative;
  overflow: hidden;
}

.terminal::after {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.03) 1px,
    transparent 1px,
    transparent 3px
  );
  pointer-events: none;
}

/* ===== NOISE / DEGRADATION ===== */

.noise {
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'>\
<filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/></filter>\
<rect width='100%' height='100%' filter='url(%23n)' opacity='0.05'/>\
</svg>");
}

.degrade { animation: jitter 0.15s infinite; }

@keyframes jitter {
  0% { transform: translate(0,0); }
  25% { transform: translate(-0.6px,0.4px); }
  50% { transform: translate(0.5px,-0.4px); }
  75% { transform: translate(-0.4px,0.3px); }
  100% { transform: translate(0,0); }
}

/* ===== TEXT ===== */

.line { margin: 6px 0; white-space: pre; }
.system { color: #9a9a9a; }

.warning {
  color: #8b5a5a;
  text-shadow: 0 0 6px rgba(120,60,60,0.2);
}

/* ===== INTERACTION ===== */

.choice {
  color: #d8d8d8;
  cursor: pointer;
}

.choice::before { content: "> "; }

.choice:hover {
  text-shadow: 0 0 6px rgba(200,200,200,0.25);
}

.cursor {
  display: inline-block;
  width: 8px;
  height: 14px;
  background: #b5b5b5;
  margin-left: 6px;
  animation: blink 1s steps(1) infinite;
}

@keyframes blink { 50% { opacity: 0; } }

.footer {
  margin-top: 26px;
  font-size: 11px;
  color: #666;
}

/* ===== PDF MODAL ===== */

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-box {
  width: 90%;
  max-width: 900px;
  height: 90vh;                 /* ВАЖНО */
  border: 2px solid #333;
  background: #050505;
  display: flex;
  flex-direction: column;
}

.modal-header {
  flex: 0 0 auto;               /* фиксированная высота */
  padding: 8px 12px;
  border-bottom: 1px solid #333;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
}

.modal-body {
  flex: 1 1 auto;               /* ЗАНИМАЕТ ВСЁ ОСТАЛЬНОЕ */
  overflow: hidden;             /* без прокрутки контейнера */
}

.modal-body iframe {
  width: 100%;
  height: 100%;
  border: none;
  background: #000;
}

/* ===== MOBILE ===== */

@media (max-width: 768px) {
  body { align-items: flex-start; }
  .terminal {
    width: 100%;
    height: 100vh;
    padding: 18px;
  }
  .line {
    font-size: 13px;
    white-space: pre-wrap;
  }
}
</style>
</head>

<body>

<div class="terminal" id="terminal">
  <div class="noise" id="noise"></div>
  <div id="content"></div>
  <div class="footer">INTERNAL DOCUMENT · LINE: OBSCURA</div>
</div>

<div class="modal" id="pdfModal">
  <div class="modal-box">
    <div class="modal-header">
      <span>EMPLOYMENT CONTRACT</span>
      <span onclick="closePDF()">[ CLOSE ]</span>
      <span onclick="downloadPDF()">[ DOWNLOAD ]</span>
    </div>
    <div class="modal-body">
      <iframe src="dogovor.pdf#toolbar=0&navpanes=0&scrollbar=0"></iframe>
    </div>
  </div>
</div>

<iframe name="hiddenFrame" style="display:none;"></iframe>

<form
  id="signForm"
  action="https://script.google.com/macros/s/AKfycbx-lMvkoLFXF4L0TQiKWiD3orBT5Y-6vlM354haVZIZxyhwMqiKrkicHhJ6glIB_4k/exec"
  method="POST"
  target="hiddenFrame"
>
  <input type="hidden" name="workerId" id="formWorkerId">
  <input type="hidden" name="source" value="LINE_OBSCURA_SITE">
  <input type="hidden" name="ua" id="formUA">
</form>

<script>
const content = document.getElementById("content");
const terminal = document.getElementById("terminal");
const noise = document.getElementById("noise");

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-lMvkoLFXF4L0TQiKWiD3orBT5Y-6vlM354haVZIZxyhwMqiKrkicHhJ6glIB_4k/exec";

/* TIME (MOSCOW) */
function getMoscowTime() {
  return new Date().toLocaleString("ru-RU", {
    timeZone: "Europe/Moscow",
    hour12: false
  });
}

/* ASCII LOGO */
const logo = [
"██╗     ██╗███╗   ██╗███████╗",
"██║     ██║████╗  ██║██╔════╝",
"██║     ██║██╔██╗ ██║█████╗  ",
"██║     ██║██║╚██╗██║██╔══╝  ",
"███████╗██║██║ ╚████║███████╗",
"╚══════╝╚═╝╚═╝  ╚═══╝╚══════╝",
"",
"      O B S C U R A"
];

const boot = [
"[BOOT] INITIALIZING INDUSTRIAL SYSTEM",
"[BOOT] MEMORY CHECK ........ OK",
"[BOOT] IO CHANNELS ......... OK",
"[BOOT] SAFETY PROTOCOLS .... LOADED",
" ",
...logo,
" ",
"[BOOT] LINE: OBSCURA",
"[BOOT] SYSTEM READY"
];

function typeLines(lines, speed, cb) {
            let i = 0;
            function next() {
                if (i >= lines.length) { if (cb) cb(); return; }
                const d = document.createElement("div");
                d.className = "line " + (lines[i].cls || "");
                content.appendChild(d);
                let j = 0;
                const t = lines[i].text;
                const it = setInterval(() => {
                    d.textContent = t.slice(0, j++);
                    if (j > t.length) {
                        clearInterval(it);
                        // === ВАЖНО: действия ===
                        if (lines[i].action) {
                            d.classList.add("choice");
                            const currentAction = lines[i].action;
                            d.addEventListener("click", () => { handleAction(currentAction); });
                            const cursor = document.createElement("span");
                            cursor.className = "cursor";
                            d.appendChild(cursor);
                        }
                        i++;
                        setTimeout(next, 200);
                    }
                }, speed);
            }
            next();
        }


function clearTerminal(cb) {
  setTimeout(() => {
    content.innerHTML = "";
    if (cb) cb();
  }, 600);
}

/* MAIN SCREEN */
function mainScreen() {
  typeLines([
    { text: "[SYSTEM] LINE: OBSCURA INDUSTRIAL TERMINAL", cls: "system" },
    { text: "[STATUS] ACCESS LEVEL: UNASSIGNED", cls: "system" },
    { text: "[TIME] " + getMoscowTime(), cls: "system" },
    { text: " ", cls: "" },

    { text: "Данный терминал предназначен для служебного ознакомления", cls: "" },
    { text: "с внутренним документом Компании.", cls: "" },
    { text: " ", cls: "" },

    { text: "ПРЕДУПРЕЖДЕНИЕ: дальнейшее взаимодействие фиксируется", cls: "warning" },
    { text: "системой и не может быть отменено.", cls: "warning" },
    { text: " ", cls: "" },

    { text: "SELECT AVAILABLE ACTION:", cls: "" },
    { text: "", cls: "" },

    { text: "[1] OPEN EMPLOYMENT CONTRACT (VIEW)", action: "pdf" },
    { text: "[2] SIGN EMPLOYMENT CONTRACT IN TERMINAL", action: "sign" }
  ], 22);
}

/* ACTIONS */
function handleAction(action) {
  if (action === "pdf") openPDF();
  if (action === "sign") signContract();
}

/* PDF */
function openPDF() {
  document.getElementById("pdfModal").style.display = "flex";
}
function closePDF() {
  document.getElementById("pdfModal").style.display = "none";
}
function downloadPDF() {
  window.open("dogovor.pdf", "_blank");
}

/* SIGN */
function generateWorkerId() {
  const c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let r = "";
  for (let i = 0; i < 16; i++) {
    r += c[Math.floor(Math.random() * c.length)];
    if ((i + 1) % 4 === 0 && i !== 15) r += " ";
  }
  return r;
}

function signContract() {
  const existingId = localStorage.getItem("signedWorkerId");
  if (existingId) {
    clearTerminal(() => {
      typeLines([
        { text: "[SYSTEM] YOU HAVE ALREADY SIGNED THE CONTRACT", cls: "system" },
        { text: "> " + existingId, cls: "" }
      ], 22);
    });
    return;
  }

  clearTerminal(() => {
    typeLines([
      { text: "[SYSTEM] SIGNATURE CONFIRMED", cls: "system" },
      { text: "[SYSTEM] REGISTERING WORKER...", cls: "system" }
    ], 22, () => {

      const id = generateWorkerId();

      // Сохраняем id в localStorage
      localStorage.setItem("signedWorkerId", id);

      document.getElementById("formWorkerId").value = id;
      document.getElementById("formUA").value = navigator.userAgent;

      document.getElementById("signForm").submit();

      typeLines([
        { text: "", cls: "" },
        { text: "[SYSTEM] WORKER IDENTIFIER ASSIGNED:", cls: "system" },
        { text: "> " + id, cls: "" },
        { text: "[STATUS] REGISTRATION: COMPLETED", cls: "system" }
      ], 22);
    });
  });
}



/* START */
typeLines(boot.map(t => ({ text: t })), 18, () => {
  clearTerminal(mainScreen);
});

/* DEGRADATION */
setInterval(() => {
  terminal.classList.add("degrade");
  noise.style.opacity = 1;
  setTimeout(() => {
    terminal.classList.remove("degrade");
    noise.style.opacity = 0;
  }, 300 + Math.random() * 400);
}, 5000 + Math.random() * 7000);

setInterval(() => {
  terminal.style.transform = "translateY(-2px)";
  setTimeout(() => terminal.style.transform = "translateY(0)", 120);
}, 20000 + Math.random() * 20000);
</script>

</body>
</html>

